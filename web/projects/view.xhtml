<ui:composition xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ajax="http://code.google.com/p/ada-asf/ajax"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:util="http://code.google.com/p/ada-asf/util"
                xmlns:awa="http://code.google.com/p/ada-awa/jsf"
                template="/WEB-INF/layouts/layout.xhtml">
    <ui:param name="title" value="#{projectMsg.projects_title}" />
    <ui:param name="pageStyle" value="awax"/>

    <!-- Main page body -->
    <ui:define name="pageBody">
        <f:metadata>
            <f:viewAction action='#{project.load}'/>
        </f:metadata>
        <div id='awa-content'>
            <ui:include src="/projects/views/workspace-nav.xhtml">
                <ui:param name="project_id" value="#{ticket.project_id}"/>
            </ui:include>
            <div class="project-title">
                <ul class="awa-page-actions">
                        <li>
                            <a class='awa-button' href="#{contextPath}/projects/edit/#{project.id}">#{projectMsg.project_page_edit_label}</a>
                        </li>
                    <li>
                        <a class='awa-button' href="#{contextPath}/projects/history/#{project.id}">#{projectMsg.project_page_history_label}</a>
                    </li>
                </ul>
                <h2>#{project.name}</h2>
            </div>
            <awa:tagList value='#{project.tags}' id='qtags' styleClass="awa-tag-list tagedit-list"
                         tagLink="#{contextPath}/projects/tags/#{tagName}"
                         var="tagName"
                         tagClass="tagedit-listelement tagedit-listelement-old"/>
            <ui:include src="views/project-info.xhtml"/>
            <div class="project-tickets">
                <h3>#{projectMsg.project_view_tickets_title}</h3>
            </div>
            <div class="project-tickets">
                <ul class="awa-page-actions">
                    <li>
                        <a href="#{contextPath}/tickets/create/#{project.id}" class="awa-button" title="Create">Create ticket</a>
                    </li>
                </ul>
            </div>
            <ajax:include id="ticket-list" styleClass="asf-container project-ticket-list" async="true"
                          src="/tickets/list/#{project.id}"/>
            <util:script>
                $('#ticket-list').list({
                    actionId: '#wiki-page-action',
                    itemPrefix: 't_',
                    deleteUrl: '#{contextPath}/wikis/forms/delete-page.html?id=',
                    selectAction: function(list, node, event) {
                        var target = event.target;
                        if ($(node).hasClass('wiki-edit')) {
                            var name = $(list.currentNode).attr('data-name');
                            document.location = '#{contextPath}/wikis/edit/#{wikiList.wiki_id}/' + name;
                        }
                        if ($(target).hasClass('ticket-list-status')) {
                            ASF.Update($('#ticket-list'), '#{contextPath}/tickets/list/#{project.id}');
                        }
                    }
                });
            </util:script>
        </div>
    </ui:define>
    <ui:define name="pageScript">
        <script type="text/javascript" src="#{jquery.chosenPath}"></script>
    </ui:define>

</ui:composition>
